<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using VASP for density functional theory (DFT)</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            /* Light gray background */
            color: #333;
            /* Dark gray text color */
        }

        header {
            width: 100%;
            text-align: center;
            padding: 2em 0;
        }

        .main-title {
            font-size: 2.5em;
            margin-bottom: 0.5em;
            font-weight: bold;
        }

        .section {
            width: 80%;
            margin-top: 2em;
            margin-left: 10%;
            /* Align left */
            text-align: left;
            /* Align left */
            background-color: #fff;
            /* White background */
            padding: 2em;
            border-radius: 10px;
            /* Rounded corners */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            /* Soft shadow */
        }

        .section h2 {
            font-size: 2em;
            margin-bottom: 1em;
            color: black;
            /* Black heading color */
            text-align: center;
            /* Center align */
        }

        .section p {
            font-size: 1.1em;
            margin-bottom: 1em;
            line-height: 1.6;
            /* Improved line spacing */
        }

        footer {
            width: 100%;
            text-align: center;
            padding: 1em 0;
            background-color: #f5f5f5;
        }

        footer a {
            text-decoration: none;
            color: #333;
        }

        .section-divider {
            width: 100%;
            height: 1px;
            background-color: #ccc;
            margin-top: 2em;
            margin-bottom: 2em;
        }
    </style>
</head>

<body>

    <header>
        <h1 class="main-title">Using VASP for density functional theory (DFT)
        </h1>
    </header>

    <section class="section" id="SSH-Notes">
        <h2>Handy Terminal Commands</h2>

        <p>Login: <code>ssh [username]@[serverIP]</code></p>

        <p>Password: <code>[password]</code></p>

        <p>Copying a file from your local machine to the destination server:
            <code>scp ~/[local file path] [username]@[serverIP]:~</code>
        <ul>
            <li>Note that moving files between your local computer and the server
                must be done within a terminal without being logged into the server</li>
            </p>

            <p>Copying a file from the server to your local machine:
                <code>scp [username]@[serverIP]:~/[server file path]
                ~/[local file path]</code>
            </p>

            <p>Copying a folder from your local machine to the destination
                server: <code>scp -r ~/[local file path] [username]@[serverIP]:~
            </code></p>

            <p>Check CPU% of server and status of files: <code>top</code> or
                <code>htop</code>
            </p>

            <p>Finding a job directory from PID #: <code>pwdx [PID#]</code> </p>

            <p>See files in the working directory: <code>ls</code></p>
            <p>Delete files: <code>rm [filename]</code></p>
            <p>Delete folders + contents: <code>rm -r [foldername]</code></p>
            <p>Make a directory: <code>mkdir [foldername]</code></p>
            <p>Copy folders + contents: <code>cp [foldername] [destinationfolder]</code></p>
            <p>View & edit a file: <code>vim [filename]</code></p>
            <p>Rename a file: <code>mv [oldfilename] [newfilename]</code></p>
            <ul>
                <li>To enter insert mode, click esc</li>
                <li>To save and exit, type esc (to leave insert mode) + <code>:wq</code> + enter</li>
                <li>To exit without saving after typing, type esc (to leave insert mode) + :q! + enter</li>
            </ul>

            <div class="section-divider"></div>
    </section>

    <section class="section" id="files">
        <h2>Before You Start: Creating the Necessary Files</h2>

        <h3>POSCAR file</h3>
        <ol>
            <li>Open CIF files with VESTA, which you can download <a
                    href="https://jp-minerals.org/vesta/en/download.html" target="_blank" rel="noopener">here</a>.</li>
            <li>Export structure as fractional coordinate (rename the files as
                POSCAR in a folder with whatever naming convention you prefer)
                <ul>
                    <li>On Macbook, it can only saved as POSCAR.vasp so you can't just delete it. You can
                        only remove the .vasp with the command <code>mv POSCAR.vasp POSCAR</code></li>
                </ul>
            <li>Move POSCAR files from local computer to your folder on the destination
                server with terminal/powershell using the above keys
            <li>I name the first folder as [composition-structure] and will have
                the specific composition named as composition or structure
                type, depending on what I’m doing, such as CeRuSi2-CeNiSi2. However,
                everyone works their own way, just make sure to keep detailed notes.</li>
            </li>
        </ol>
        </li>
        </ol>

        <h3>POTCAR file</h3>
        <ol>
            <li>Check order of POSCAR molecules for the potcreate command
                <ul>
                    <li>For example: <code>potcreate Si Fe Ce</code> in command
                        line, which matches the order of molecules in the
                        POSCAR file</li>
                </ul>
            </li>
            <li>Check available element potentials like this:
                <code>potshow Si</code>
            </li>
            <li>You can also generate POTCAR files using VASPKIT:
                <ul>
                    <li>Type <code>vaspkit</code> in the terminal</li>
                    <li>Type <code>01</code> for VASP Input-Files Generator</li>
                    <li>Type <code>103</code> to generate POTCAR file with default settings</li>
                    <li>Note: Your PBE directory must be set up correctly when installing VASP</li>
                </ul>
            </li>
        </ol>
        </ol>
        </li>
        </ol>

        <h3>INCAR file</h3>
        <ol>
            <li>Copy the INCAR from this template below, or download it <a href="assets/INCAR" download>here</a>.</li>
            <ul>
                <div style="border: 1px solid #ccc; padding: 10px;">
                    <code>
                            ### INCAR-Template for VASP Calculations - Martin
                            Changed 2015-12-22<br>
                            ## General Parameters/Electronic Relaxation<br>
                            PREC =Accurate # Precision<br>
                            ENCUT = 500 # cutoff energy for the planewave basis
                            set
                            in eV.<br>
                            EDIFF = 1E-8 # convergence condition for the
                            electronic
                            loop<br>
                            NELM = 150 # maximum number of electronic
                            iterations<br>
                            NELMIN = 4 # minimum number of electronic
                            iterations<br>
                            KPAR = 2 # no. of nodes (max. no. of k-points)<br>
                            NCORE = 4 # no. of cores per node<br>
                            #LWAVE = .FALSE.# Do not write WAVECAR<br>
                            ## Structure Optimization (or static for NSW=0)<br>
                            EDIFFG = 1E-6 # convergence criterion for ionic
                            loops
                            (pos=energy; neg=forces)<br>
                            NSW = 1000 # number of ionic steps<br>
                            IBRION = 1 # ionic update: 1:QN, 2:CG (for bad
                            guesses)<br>
                            ISIF = 3 # freedom: 2=ions; 4=ions,shape;
                            3=ions,shape,vol<br>
                            MAXMIX = 80 # max number steps stored in Broyden
                            mixer,
                            when negative: resets after ionic step<br>
                            ISMEAR = 1 # smearing: -5-insul/scond/DOS 0-large
                            systems (with SIGMA 0.05) 1-metals (with SIGMA
                            0.2)<br>
                            ## DOS and Band Structure Calcuations (for
                            ICHARG=11
                            prev. CHGCAR required)<br>
                            #NEDOS = 1001 # number of DOS gridpoints<br>
                            #LORBIT = 10 # DOSCAR and PROCAR are written<br>
                            #ISMEAR = -5 # smearing: -5-insul/scond/DOS 0-large
                            systems 1-metals (with SIGMA)<br>
                            ## Bader Charge and Electron localization
                            function<br>
                            #LAECHG = .TRUE.<br>
                            #LELF=.TRUE.<br>
                            #NPAR = 1<br>
                            ## COHP Analysis (via LOBSTER)<br>
                            #LWAVE = .TRUE.<br>
                            #NSW = 0<br>
                            #ISYM = -1<br>
                            #NBANDS = 600 ! should equal the total number of
                            orbitals<br>
                            #LORBIT = 12<br>
                            #ISTART = 0<br>
                            ## Phonon Dispersion via finite displacements<br>
                            #EDIFF = 1E-8 # delete other EDIFF tags!!!<br>
                            #ISMEAR = 0<br>
                            #SIGMA = 0.01<br>
                            #ADDGRID = .TRUE.<br>
                            ## Hybrid Calculations<br>
                            LHFCALC=.TRUE. # use of HF/DFT hybrid
                            functionals<br>
                            AEXX = 0.25 # fraction of exact exchange<br>
                            AGGAX = 0.75 # fraction of GGA<br>
                            ALGO = Damped # electronic minimisation algorithm
                            (damped velocity friction algo.)<br>
                            TIME = 0.05 # time step for ALGO<br>
                            PRECFOCK = FAST # controls FFT grid for the exact
                            exchange<br>
                            HFSCREEN = 0.2 # determines the range separation
                            parameter<br>
                            NKREDX = 2 # grid reduction factors<br>
                            NKREDY = 2 # grid reduction factors<br>
                            NKREDZ = 2 # grid reduction factors<br>
                            ## Stress Tensor Calculation<br>
                            #ENCUT = 600 # delete other ENCUT tags!!!<br>
                            #IBRION = 6<br>
                            #ISIF = 6<br>
                            #NSW = 1<br>
                            #NFREE = 2<br>
                            ## additionally for DFPT:<br>
                            #IBRION = 8<br>
                            #NWRITE = 3<br>
                            #NSW = 1<br>
                            ## Supercell (band offset) calculations<br>
                            #LVHAR = .TRUE.<br>
                            #AMIN = 0.1<br>
                            ## Born Effective Charge<br>
                            #LEPSILON = .TRUE. ! dielectric matrix<br>
                            #LOPTICS = .TRUE. ! DFPT including empty bands for
                            hybrid functionals<br>
                            ## Spin-orbing Coupling<br>
                            #LSORBIT = .TRUE.<br>
                            #LNONCOLLINEAR = .TRUE.<br>
                            ##GGA+U, Coulomb interaction energy<br>
                            #LDAU = .TRUE.<br>
                            #LDAUTYPE = 1 !1 = Liechtenstein et al.; 2 =
                            Dudarev's
                            approach, only the difference (U-J) is
                            meaningfull<br>
                            #LDAUPRINT = 0<br>
                            #LDAUU = 0 3.71 0 0<br>
                            #LDAUJ = 0 0 0 0<br>
                            #LASPH = .TRUE.<br>
                        </code>
                </div>
                <li>Adjust accordingly per your calculation of course. The
                    above template indicates a structure optimization, as
                    it's not commented out with '#'</li>
            </ul>
            </li>
        </ol>


        <h3>KPOINTS file</h3>
        <ol>
            <li>Generate the file using VASPKIT, as seen in the video here <a
                    href="https://www.youtube.com/watch?v=AgqwACyBgGw&pp=0gcJCcwJAYcqIYzv" target="_blank"
                    rel="noopener">.</a></li>
            <li>You can also use VASPKIT by typing <code>vaspkit</code> in the terminal, then <code>01</code> for VASP
                Input-Files Generator, and <code>102</code> for KPOINTS file.</li>
            <li>This file is an attempt to solve Schrodinger's equation… which
                is technically an infinite attempt as you have a guess and set
                up the cutoff and wanted precision in POSCAR file
                <ul>
                    <li><strong>K-Points:</strong> This line indicates the type
                        of k-points generation scheme being used. In this case,
                        it's set to "Gamma", meaning a single k-point at the
                        center of the Brillouin zone.</li>
                    <li><strong>0:</strong> This value typically denotes the
                        number of k-points to be generated. Here, "0" implies a
                        single k-point.</li>
                    <li><strong>Gamma:</strong> Specifies the center of the
                        Brillouin zone where the k-point is placed.</li>
                    <li><strong>8 2 8:</strong> Defines the mesh size, i.e.,
                        the number of k-points along each reciprocal lattice
                        vector direction. "8 2 8" indicates 8 k-points along
                        the first lattice vector, 2 along the second, and 8
                        along the third.</li>
                    <li><strong>0 0 0:</strong> Specifies any fractional shifts
                        applied to the k-point grid. In this example, there are
                        no shifts applied.</li>
                </ul>
            </li>
        </ol>
    </section>

    <section class="section" id="vaspkit-installation">
        <h2>Installing VASPKIT</h2>
        <div style="text-align:center; margin-bottom:1em;">
            <a href="https://vaspkit.com/installation.html" target="_blank" rel="noopener">
                <img src="https://i.ytimg.com/vi/RfVP3ue0gZo/hqdefault.jpg?sqp=-oaymwEjCNACELwBSFryq4qpAxUIARUAAAAAGAElAADIQj0AgKJDeAE=&rs=AOn4CLD9P7cXKKv0d5DbBlgBJYqU0pPq5A"
                    alt="VASPKIT Installation Tutorial Thumbnail"
                    style="max-width:100%;height:auto;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
            </a>
            <br>
            <a href="https://vaspkit.com/installation.html" target="_blank" rel="noopener">
                Installation instructions
            </a>
        </div>
        <ol>
            <li>Visit the <a href="https://vaspkit.com/installation.html" target="_blank" rel="noopener">VASPKIT
                    installation page</a> for step-by-step instructions for Linux, macOS, and Windows.</li>
            <li>Follow the guide to download, compile, and set up VASPKIT on your system.</li>
            <li>For a visual walkthrough, see the tutorial video above.</li>
            <li>Once installed, you can run VASPKIT by typing <code>vaspkit</code> in your terminal.</li>
        </ol>
        <div class="section-divider"></div>
    </section>


    <!-- DFT Notes
- Gamma -> Monkhorst pack?
- KPOINTS consistency? 
	- Mesh & Gamma v. Monkhorst
- Run both & see the difference… 

What Γ centered means is that the offsets are all 0. For some systems it may be beneficial to use non-centered grids to reduce the total number of k-points due to symmetries. 
the shift away from Gamma was originally meant to reduce the grid size. one reason for using Gamma-centered sampling sometimes is that shifted grids may overlook "important" band character may near Gamma (often there is a gap there in semiconductors, e.g.) if your sampling is coarse. so the choice depends on your application. notice that in metals Gamma-centered sampling (NOT sampling Gamma only!) is often a better choice (a faster-converging choice, let us say) than the shifted grid.
also, let me point you to the original paper (by my own supervisor ;) on special points: http://journals.aps.org/prb/abstract/10.1103/PhysRevB.7.5212
We strongly recommend to use only Gamma centered grids for hexagonal lattices. Many tests we have performed indicate that the energy converges significantly faster with Gama centered grids than with standard Monkhorst Pack grids. Grids generated with the M setting in the third line, in fact do not have full hexagonal symmerty.
- See The Role of Non-Stoichiometry in the Functional Properties of Oxide Materials
In principle, so mathematically both ways of generating the grid would converge at the same pace with the increasing number of k points if the function to be integrated was arbitrary: They both are equi-distance samplings of a random function with the same distance between the sampling points. The difference and possible preference of one over the other are:
- As stated in the communication between Monkhorst and Pack and Chadi and Cohen on the other hand, the original sets of Monkhorst-Pack grids did not include the Gamma point, and they had a lower symmetry in some cells - in particular the hexagonal one - than the maximum symmetry of the cell (after the Comment by Chadi and Cohen on their original article Monkhorst and Pack devised the present Monkhorst-Pack algorithm where the whole grid of points can be translated - for example so that one of the points hits the Gamma point); this leads to either asymmetric sets of k points and thus a breaking of the symmetries, or, like probably in most codes, to a generation of many more k points that would be in the original set in order to preserve the symmetries. So if there are symmetries, like C_3v in many hexagonal systems, it is more economic and symmetric to use the Gamma-centred sets of Monkhorst-Pack grids
- The underlying function to be integrated is not fully random, rather it contains regularity - what we call bands. In the band structure at the Gamma point is always (well, except maybe with spin-orbit coupling, but in general) the bands have their extrema, either a local minimum or maximum (the bands arrive at the Gamma point with zero derivative). So when people could only afford few k points in their calculations they first had the special points - like the Baldereschi point - that all avoided the Gamma point, as the band structure was thought to be more accurately averaged/integrated over if one did not take the Gamma point but a point that was away from the Gamma, kind of averaging over bands better than at Gamma, where one has those local minima and maxima. When one has enough k points it naturally does no longer matter whether one includes the Gamma point or not, as the weight of the Gamma (and possibly other points at the boundaries of the first Brillouin zone) diminishes
So in general, if one has a hexagonal cell and symmetries in the atomistic structure, it is better to take the Gamma-centred Monkhorst-Pack sets, as one gets all symmetries included with fewer k points that the translated ones. Overall the convergence depends on the underlying band structure, in exotic cases (Kohn anomalies, Dirac point like in graphene, ...) one might need to adjust case by case. But, in "normal" cells with "normal" band structure the difference between the two kinds of choice in the speed of convergence with the number of k points and thus computational speed is probably small.

Gamma Only: A k-point mesh (grid) only includes (samples) the gamma point of the Brillouin zone.

Gamma Centred: A k-point mesh (grid) that is centred around the gamma point of the Brillouin zone, and includes other points (often equally spaced, though not always). A gamma centred k-point grid often reduces computation cost, and contains important information with regard to band-gaps. However, a gamma centred k-point grid can fail to describe metallic ground-states. In general, a gamma k-point grid is often more advantages (although check your system).

For instance, in relation to surface calculations (from Efficient creation and convergence of surface slabs): One must also be mindful that the k-point sampling accurately reflects the reciprocal Bravais lattice of the surface Brillouin zone — for example, the (111) surfaces of FCC and BCC crystals are hexagonal and require a gamma-centered odd k-point grid.

Monkhorst-Pack: A special type of k-point mesh (grid). The sampling k-points are distributed homogeneously in the Brillouin zone, with rows or columns of k-points running parallel to the reciprocal lattice vectors that span the Brillouin zone.

From the original paper Special points for Brillouin-zone integrations: A method is given for generating sets of special points in the Brillouin zone which provides an efficient means of integrating periodic functions of the wave vector. The integration can be over the entire Brillouin zone or over specified portions thereof.

the Gamma grid is indeed made with the Monkhorst-Pack scheme, but after the generation the grid is shifted so that one of the k-points lies on the gamma point.

Or in other words, for a grid with odd divisors, there is no difference between the Gamma and MP scheme. They produce exactly the same result.

Coarse mesh optimization, fine mesh calculations

For grids centred on the Gamma-point, even grids sometimes have better convergence than odd grids. This is precisely because they avoid the gamma-point itself, which is a very high symmetry point and not a good representative sampling point.
For systems with hexagonal symmetry, however, you should basically *never* use an even-grid (gamma-centred) because the hexagonal symmetry operations applied to an even grid generate points outside the Brillouin zone (see the papers of Chadi and Cohen for details; link below).
You may find this discussion useful:
https://www.researchgate.net/post/Is_there_an_optimum_number_of_k_points_in_the_irreducible_Brilloiun_zone_that_is_necessary_for_good_calculations_of_bulk_total_energy
 -->

    <section class="section" id="geometry-optimization">
        <h2>Geometry Optimization</h2>
        <div style="text-align:center; margin-bottom:1em;">
            <a href="https://www.youtube.com/watch?v=AgqwACyBgGw&pp=0gcJCcwJAYcqIYzv" target="_blank" rel="noopener">
                <img src="https://img.youtube.com/vi/AgqwACyBgGw/0.jpg"
                    alt="Structure Optimization for DFT with VASP YouTube Thumbnail"
                    style="max-width:100%;height:auto;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
            </a>
            <br>
            <a href="https://www.youtube.com/watch?v=AgqwACyBgGw&pp=0gcJCcwJAYcqIYzv" target="_blank" rel="noopener">
                Tutorial video
            </a>
        </div>
        <ol>
            <li>
                <span style="color: red; font-weight: bold;">
                    Note: <code>mpirun</code> is a command used to launch parallel programs written using the Message
                    Passing Interface (MPI) standard.
                </span>
            </li>
            <li>
                <span style="color: red; font-weight: bold;">
                    The Oliynyk lab uses SLURM for job scheduling, so you need a job file. See the template <a
                        href="assets/job" target="_blank" rel="noopener">here</a>.
                </span>
            </li>
            <li>Once all the above files are created, you’re ready to go with
                optimizing. You MUST do this before anything else. It is
                pertinent to start any calculations with an optimized and most
                thermodynamically stable geometry.</li>
            <li>
                To run with SLURM, use:
                <ul>
                    <li><code>sbatch job</code></li>
                    <li>Check status: <code>sq</code></li>
                    <li>Cancel a job: <code>scancel [job no.]</code> (job number shown by <code>sq</code>)</li>
                    <li><strong>Tip:</strong> Change the job name in your job file for each run so cancelling is easy.
                    </li>
                </ul>
            </li>
            <li>type <code>mpirun -np 16 vasp_std&gt;1&amp;</code> <span
                    style="color: #2196F3; font-weight: bold;">(Oliynyk lab - use <code>sbatch job</code> after setting
                    job file)</span> in the
                command line while in the directory of the folder with your
                files. "1" indicates the first run, "2" indicates the second,
                and "3" indicates the third. I do this to keep track of
                everything, but you can just repeat the same command after
                copying CONTCAR to POSCAR.</li>
            <li>Can view status of calculation/warnings with the following
                command:
                <ul>
                    <li><code>Vim + 1</code></li>
                    <li><code>tail 1</code> (only displays last couple of
                        lines)</li>
                </ul>
            </li>
            <li>Can view energy with the following command:
                <ul>
                    <li><code>grep TOTEN OUTCAR</code></li>
                </ul>
            </li>
            <li>If ‘reached required accuracy - stopping structural energy
                minimisation’ is displayed at the bottom of file 1, this
                indicates it has reached your threshold of accuracy, indicated
                by EDIFF in the INCAR file. Copy the optimized structure to the
                structure input file with:
                <ul>
                    <li><code>cp CONTCAR POSCAR</code></li>
                </ul>
            </li>
            <li>Continue with the second run:
                <ul>
                    <li><code>mpirun -np 4 vasp_std&gt;2&amp;</code> <span
                            style="color: #2196F3; font-weight: bold;">(Oliynyk lab - use <code>sbatch job</code> after
                            setting job file)</span></li>
                </ul>
            </li>
            <li>If ‘reached required accuracy - stopping structural energy
                minimisation’ is displayed at the bottom of file 2, copy the
                optimized structure to the structure input file with:
                <ul>
                    <li><code>cp CONTCAR POSCAR</code></li>
                </ul>
            </li>
            <li>Continue with the third run:
                <ul>
                    <li><code>mpirun -np 4 vasp_std&gt;3&amp;</code> <span
                            style="color: #2196F3; font-weight: bold;">(Oliynyk lab - use <code>sbatch job</code> after
                            setting job file)</span></li>
                </ul>
            </li>
            <li>If ‘reached required accuracy - stopping structural energy
                minimisation’ is displayed at the bottom of file 3, copy the
                optimized structure to the structure input file with:
                <ul>
                    <li><code>cp CONTCAR POSCAR</code></li>
                </ul>
            </li>
        </ol>

        <h3>For hybrid calculations</h3>
        <ol>
            <li>If a certain potential cannot converge no matter what, you need
                to enable the section for the hybrid calculations in the INCAR
                file. The optimization will take much longer, up to weeks in
                some cases.
            </li>
            <li>In case there’s a problem with convergence, the way to fix that
                would be changing TIME = 0.2 to 0.1 in the INCAR file.
            </li>
            <li>Setting an easier convergence criterion, namely 10^-6 and 10^-5
                for electronic and ionic loop respectively may help with
                stubborn structures.
            </li>
        </ol>

        <div class="section-divider"></div>
    </section>


    <section class="section" id="data-accrual">
        <h2>Data Accrual</h2>
        <ol>
            <li>
                <strong>For free energy:</strong>
                <ul>
                    <li>While in the structure directory, type <code>grep TOTEN
                            OUTCAR</code> to see the final energy of the
                        optimized structure, which is the last iterated value
                        at the bottom.</li>
                    <li>Looks like this:</li>
                    <img src="images/data_accrual_1.png" alt="Free Energy Image Placeholder">
                </ul>
            </li>
            <li>
                <strong>For optimized parameters:</strong>
                <ul>
                    <li>While in the structure directory, type <code>vim
                            POSCAR</code></li>
                    <li>This is why we type <code>cp CONTCAR POSCAR</code> at
                        the end of our third optimization iteration.</li>
                    <li>One can also just type <code>vim CONTCAR</code>, but we
                        want to export POSCAR later for further calculations –
                        so it’s best to do the first command in 1.</li>
                    <li>Looks like this:</li>
                    <img src="images/data_accrual_2.png" alt="Optimized Parameters Image Placeholder">
                    <li>After opening the file in the vim editor, you will see
                        the optimized parameters as displayed in the image
                        above.</li>
                    <li>Where the first line with values indicates parameter A,
                        second indicates B, and third indicates C (in
                        Angstroms).</li>
                    <ul>
                        <li>In this case, we have a matrix representation of a
                            non-orthogonal unit cell. It is monoclinic. You
                            will notice that there are more than one value in
                            each line.</li>
                        <img src="images/data_accrual_3.png" alt="Optimized Parameters Matrix Image Placeholder">
                        <li>To deal with this and convert it to appropriate
                            parameters as well as angles, import the
                            optimized POSCAR to VESTA and report the
                            A, B and C cell parameters as well as the β Angle
                            (°) in the summary section. <br>
                            <img src="images/data_accrual_4.png" alt="VESTA Summary Image Placeholder">
                        </li>
                    </ul>
                </ul>
            </li>
        </ol>
        <div class="section-divider"></div>
    </section>

    <section class="section" id="2">
        <h2>Density of States - DOSCAR</h2>
        <div style="text-align:center; margin-bottom:1em;">
            <a href="https://www.youtube.com/watch?v=EIuBtJcfXCE" target="_blank" rel="noopener">
                <img src="https://img.youtube.com/vi/EIuBtJcfXCE/0.jpg" alt="DOSCAR Analysis YouTube Thumbnail"
                    style="max-width:100%;height:auto;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
            </a>
            <br>
            <a href="https://www.youtube.com/watch?v=EIuBtJcfXCE" target="_blank" rel="noopener">
                Tutorial video
            </a>
        </div>
        <ol>
            <li>Uncomment <i>DOS & band structure</i> and <i>General
                    Parameters</i> (never <code>LWAVE = .FALSE.</code>) in INCAR as we need the WAVECAR file for this.
            </li>
            <li>Non-spin polarized DOSCAR
            <li><strong>Spin-Polarized and Non-Spin-Polarized :</strong>
                <ul>
                    <li><code>ISPIN=1</code> (non-spin-polarized) and <code>ISPIN=2</code> (spin-polarized)
                        calculations.</li>
                </ul>
            </li>
            <li>Atomic orbital contribution settings:</li>
            <ul>
                <li><code>LORBIT=11-14</code>: Individual orbitals are lm-resolved/decomposed (e.g., px, py, pz, etc.).
                </li>
                <li><code>LORBIT=0, 1, 2, 5, 10</code>: Orbitals are grouped (e.g., total p-orbital contributions).</li>
            </ul>
            </ul>
            </ul>
            <li>Run with <code>mpirun -np 16 vasp_std&gt;Dos1&amp;</code> <span
                    style="color: #2196F3; font-weight: bold;">(Oliynyk lab - use <code>sbatch job</code> after setting
                    job file)</span></li>
            <li>Copy DOSCAR files to local desktop for analysis
                when converged</li>
            </ul>
            </li>
            <li>
                <strong>Plotting DOSCAR:</strong>
                <ul>
                    <li>You can plot the exported POSCAR and DOSCAR files using <a
                            href="https://doscar-gui-9a48cc5d4e0d.herokuapp.com" target="_blank"
                            rel="noopener">DOSCAR-GUI</a>.</li>
                    <li>More information and settings can be found on <a
                            href="https://github.com/EmilJaffal/doscar-gui/blob/main/README.md" target="_blank"
                            rel="noopener">GitHub</a>.</li>
                </ul>
            </li>
            </ul>
            </li>
        </ol>
        <div class="section-divider"></div>
    </section>

    <section class="section" id="magnetic-moment">
        <h2>Magnetic Moment Calculation</h2>
        <ol>
            <li>Spin-polarized DOSCAR (only if magnetism is expected here,
                otherwise you can ignore this)
                <ul>
                    <li>Add the following to the INCAR:</li>
                    <ul>
                        <li>ISPIN = 2</li>
                        <li>MAGMOM = ie.) 4*0 4*1 OR 0 0 0 0 1 1 1 1</li>
                        <ul>
                            <li>This can only be full integers</li>
                            <li>This is your prediction, the OUTCAR file will
                                give you the software's guess</li>
                        </ul>
                    </ul>
                    <li>Run with <code>mpirun -np 8 vasp_std&gt;Dos2&amp;</code> <span
                            style="color: #2196F3; font-weight: bold;">(Oliynyk lab - use <code>sbatch job</code> after
                            setting job file)</span></li>
                    <ul>
                        <li>Rerun until the OUTCAR charges are the same as your
                            input MAGMOM prediction, as it gets better with
                            better predictions</li>
                        <ul>
                            <li>As in they’re all positive numbers or negative
                                numbers with respect to your entry. The output
                                does not have to match besides it being
                                positive or negative, usually.</li>
                        </ul>
                    </ul>
                    <li>Retrieve DOSCAR file when converged</li>
                    <li>From there, plot the same elemental contributions in
                        wxDragon like before</li>
                </ul>
            </li>
        </ol>
        <div class="section-divider"></div>
    </section>


    <section class="section" id="3">
        <h2>Electron Localization Function - ELFCAR</h2>
        <div style="text-align:center; margin-bottom:1em;">
            <a href="https://www.youtube.com/watch?v=JSJb0Opa4u4" target="_blank" rel="noopener">
                <img src="https://img.youtube.com/vi/JSJb0Opa4u4/0.jpg"
                    alt="ELFCAR + Bader CHG Calculation YouTube Thumbnail"
                    style="max-width:100%;height:auto;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
            </a>
            <br>
            <a href="https://www.youtube.com/watch?v=JSJb0Opa4u4" target="_blank" rel="noopener">
                Tutorial video
            </a>
        </div></a>
        <ol>
            <li>Uncomment <i>Bader Charge and Electron localization
                    function</i>
                and <i>General Parameters</i> in INCAR</li>
            <li>Run with <code>mpirun -np 16 vasp_std>Elf&amp;</code> <span
                    style="color: #2196F3; font-weight: bold;">(Oliynyk lab - use <code>sbatch job</code> after setting
                    job file)</span></li>
            <li>Import ELFCAR file into local computer and drag into VESPA to
                view </li>
        </ol>
        <div class="section-divider"></div>
    </section>

    <section class="section" id="4">
        <h2>Bader Charges</h2>
        <div style="text-align:center; margin-bottom:1em;">
            <a href="https://www.youtube.com/watch?v=JSJb0Opa4u4" target="_blank" rel="noopener">
                <img src="https://img.youtube.com/vi/JSJb0Opa4u4/0.jpg" alt="Bader Charges Tutorial YouTube Thumbnail"
                    style="max-width:100%;height:auto;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
            </a>
            <br>
            <a href="https://www.youtube.com/watch?v=JSJb0Opa4u4" target="_blank" rel="noopener">
                Tutorial video
            </a>
        </div></a>
        <ol>
            <li>Uncomment Bader Charge and Electron localization function and
                General Parameters in INCAR, comment out KPAR</li>
            <li>Run with <code>-np 8 vasp_std>Bader&amp;</code> <span
                    style="color: #2196F3; font-weight: bold;">(Oliynyk lab - use <code>sbatch job</code> after setting
                    job file)</span></li>
            <li>When converged run <code>chgsum.pl AECCAR0 AECCAR2</code>
                <ul>
                    <li>This combines core
                        and valence electrons
                </ul>
            </li>
            <li>type <code>bader CHGCAR -ref CHGCAR_sum</code>
                <ul>
                    <li>Looks like this:</li>
                    <img src="images/bader_1.png" alt="Bader Charges Image Placeholder">
                </ul>
            <li>Import ACF.dat to local machine or just view it in the terminal with <code>vim</code> command</li>
            </li>
            <li>Run <code>grep ZVAL POTCAR</code>
                <ul>
                    <li>Looks like this:</li>
                    <img src="images/bader_2.png" alt="Bader Charges Image Placeholder">
                </ul>
            <li>Run <code>vim POSCAR</code> if you forget the order of the molecules to
                determine which charge is which molecule</li>
            </li>
            <li>Use above values as the initial charge, see the VASP output in
                ACF.dat to determine difference, or actual charge</li>
        </ol>
        <div class="section-divider"></div>
    </section>


    <section class="section" id="6">
        <h2>Crystal Orbital Hamiltonian/Overlap Populations (COHP/COOP)</h2>
        <div style="text-align:center; margin-bottom:1em;">
            <a href="https://www.youtube.com/watch?v=RI_6urNMZIA" target="_blank" rel="noopener">
                <img src="https://img.youtube.com/vi/RI_6urNMZIA/0.jpg" alt="COHP/COOP Tutorial YouTube Thumbnail"
                    style="max-width:100%;height:auto;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
            </a>
            <br>
            <a href="https://www.youtube.com/watch?v=RI_6urNMZIA" target="_blank" rel="noopener">
                Tutorial video
            </a>
        </div>
        <ol>
            <li>Uncomment COHP Analysis (via LOBSTER) and General Parameters in
                INCAR</li>
            <li>Copy the lobsterin file from this template below, or download it <a href="assets/lobsterin"
                    download>here</a>. Note that you can only have a maximum of four interactions in one calculation.
                You can also add the lobsterin file after your calculation. lobsterin is not needed for the VASP
                calculation to run. Only for lobster to run.</li>
            <code>
                ! First, enter the energetic window in eV (relative to the
                Fermi level):<br>
                COHPstartEnergy -10<br>
                COHPendEnergy 5<br>
                !<br>
                ! Then, specify which types of valence orbitals to use:<br>
                includeorbitals s p d<br>
                ! You can also specify the basis functions per element
                manually, e.g.:<br>
                ! basisfunctions Ga 4s 4p<br>
                ! basisfunctions Sr 5s 4s 4p ! Sr_sv potential<br>
                !<br>
                ! Now define the pairs for which COHP analysis etc. should be
                done.<br>
                ! The atoms are numbered as per order in the PAW-code control
                file.<br>
                !cohpbetween atom 1 atom 10<br>
                !<br>
                ! If you are interested in single orbital COHPs, you can get
                all the pairs ! like s-s, s-p_x, ..., p_z-p_z. Uncomment this
                line to switch it on:<br>
                ! cohpbetween atom 1 atom 2 orbitalwise<br>
                !<br>
                ! If you want to generate the COHPPairs automatically, use this
                to include ! all pairs in a given distance range (in Angstrom,
                not in atomic units):<br>
                cohpGenerator from 1 to 2.5 type Si type Fe<br>
                cohpGenerator from 1 to 3.3 type Gd type Si<br>
                cohpGenerator from 1 to 3.3 type Gd type Fe<br>
                cohpGenerator from 1 to 2.6 type Si type Si<br> 
                ! and in the latter case only between the specified
                elements<br></code>
            - of course adjust accordingly to your atomic interactions and
            optimized structure's bond distances.<br>
            - I like using VESTA to visualize this<br>
            <li>type <code>mpirun -np 20 vasp_std>COHP&amp;</code> <span
                    style="color: #2196F3; font-weight: bold;">(Oliynyk lab - use <code>sbatch job</code> after setting
                    job file)</span></li>
            <li>type <code>lobster</code></li>
            <li>Note: If you do not set NBANDS or set it too low, you may see an NBANDS error in the output file. Check
                the required value, then set NBANDS to that value plus 20 for reliable results.</li>
            <li>Import COOPCAR.lobster, COHPCAR.lobster, to local machine as needed for plotting</li>
            <li>To plot COHP/COOP, save the files (COOPCAR.lobster, COHPCAR.lobster, etc.) in a <strong>.zip</strong>
                archive and upload to <a href="https://cohp-coop-gui-1de5a0643ceb.herokuapp.com" target="_blank"
                    rel="noopener">COHP-COOP-GUI</a>.</li>
            <li>See <a href="https://github.com/EmilJaffal/cohp-coop-gui/blob/main/README.md" target="_blank"
                    rel="noopener">GitHub</a> for more info and settings.</li>
        </ol>
        <div class="section-divider"></div>
    </section>

    <section class="section" id="7">
        <h2>Band Structure</h2>
        <div style="text-align:center; margin-bottom:1em;">
            <a href="https://www.youtube.com/watch?v=9LmZQUKvUo4" target="_blank" rel="noopener">
                <img src="https://img.youtube.com/vi/9LmZQUKvUo4/0.jpg" alt="Band Structure Tutorial YouTube Thumbnail"
                    style="max-width:100%;height:auto;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
            </a>
            <br>
            <a href="https://www.youtube.com/watch?v=9LmZQUKvUo4" target="_blank" rel="noopener">
                Tutorial video
            </a>
        </div>
        <ol>
            <li>Uncomment <i>DOS & band structure</i> and <i>General
                    Parameters</i> (never <code>LWAVE = .FALSE.</code>) in INCAR as we need the WAVECAR file for this.
            </li>
            <li>Then we need to use VASPKIT to create a new KPOINTS using the symmetry. Follow these steps:</li>
            <ul>
                <li>Type <code>vaspkit</code> into the terminal/powershell</li>
                <li>Type <code>03</code> to select K-Path for Band-Structure</li>
                <li>Type <code>303</code> for bulk structure</li>
                <li>Run <code>cp KPOINTS KPOINTS_old</code> to back up your old KPOINTS</li>
                <li>Run <code>cp KPATH.in KPOINTS</code> to use the new K-path</li>
                <li>This new <code>KPATH.in</code> will become your <code>KPOINTS</code> for the band structure only.
                    VASPKIT automatically suggests a K-Path based on your structure's symmetry.</li>
            </ul>
        </ol>
        <div class="section-divider"></div>
    </section>

    <section class="section" id="8">
        <h2>Calculating Hubbard U Correction For DFT+U (LSDA+U)</h2>
        <div style="text-align:center; margin-bottom:1em;">
        <a href="https://www.youtube.com/watch?v=n8UIL8rubbI" target="_blank" rel="noopener">
            <img src="https://img.youtube.com/vi/n8UIL8rubbI/0.jpg" alt="Hubbard U Correction Tutorial YouTube Thumbnail"
                style="max-width:100%;height:auto;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.15);">
        </a>
        <br>
        <a href="https://www.youtube.com/watch?v=n8UIL8rubbI" target="_blank" rel="noopener">
            Tutorial video
        </a>
        </div>

        <ol>
            <li><strong>Ground State Calculation</strong></li>
            <p>Prepare the ground state <code>INCAR</code> file for your system (example shown for NiO, but applies similarly to <b>UGe₂</b>):</p>
    <pre>
    SYSTEM       = NiO AFM
    PREC         = A
    EDIFF        = 1E-6
    ISMEAR       = 0
    SIGMA        = 0.2
    ISPIN        = 2
    MAGMOM       = 1.0 -1.0  1.0 -1.0  \
                1.0 -1.0  1.0 -1.0  \
                1.0 -1.0  1.0 -1.0  \
                1.0 -1.0  1.0 -1.0  \
                16*0.0
    LORBIT       = 11
    LMAXMIX      = 4
    </pre>

            <p class="note">This run provides the reference ground state charge density and wavefunction (<code>CHGCAR</code>, <code>WAVECAR</code>).</p>

            <li><strong>NSCF Step</strong></li>
            <p>Copy the following from the ground state directory:</p>
            <ul>
                <li><code>POSCAR</code></li>
                <li><code>POTCAR</code></li>
                <li><code>INCAR</code></li>
                <li><code>KPOINTS</code></li>
                <li><code>WAVECAR</code> and <code>CHGCAR</code></li>
            </ul>

            <p>Then add the following line to <code>INCAR</code> for the NSCF step:</p>
            <pre>ICHARG = 11</pre>

            <p>Also append these <code>LDA+U</code> parameters (example for Ni with U and J = 0.10 eV):</p>
    <pre>
    LDAU         = .TRUE.
    LDAUTYPE     = 3
    LDAUL        = 2 -1 -1
    LDAUU        = 0.10 0.00 0.00
    LDAUJ        = 0.10 0.00 0.00
    </pre>

            <p>In this example, the correction is applied to the first atom (Ni, 3d orbital). Adjust accordingly for your system.</p>

            <li><strong>SCF Step</strong></li>
            <p>From the NSCF run, copy:</p>
            <ul>
                <li><code>POSCAR</code></li>
                <li><code>POTCAR</code></li>
                <li><code>INCAR</code></li>
                <li><code>KPOINTS</code></li>
                <li><code>WAVECAR</code></li>
            </ul>

            <p>Remove <code>ICHARG = 11</code> from <code>INCAR</code> for the SCF run.</p>

            <li><strong>File Setup Note</strong></li>
            <p>
                Ensure your <code>POSCAR</code> and <code>POTCAR</code> files reflect atom-specific distinctions.
                Even if there is one unique atom type (e.g., Ni), separate entries may be used to distinguish sites receiving the U correction.
            </p>
    <pre>
    TITEL  = PAW Ni 02Aug2007
    TITEL  = PAW Ni 02Aug2007
    TITEL  = PAW O  22Mar2012
    AFM  NiO
    4.03500000 
    2.0000000000   1.0000000000   1.0000000000 
    1.0000000000   2.0000000000   1.0000000000 
    1.0000000000   1.0000000000   2.0000000000 
    1 15   16
    </pre>

            <li><strong>Parameter Sweep</strong></li>
            <p>Repeat NSCF and SCF runs for the following U = J values:</p>
            <pre>0.15, 0.20, 0.05, 0.00, -0.05, -0.10, -0.15, -0.20 eV</pre>

            <li><strong>Analysis</strong></li>
            <p>After obtaining the number of localized electrons (e.g., f or d orbital) for each run, perform linear response fitting using Python:</p>

    <pre>
    import numpy as np
    import matplotlib.pyplot as plt

    # Applied potential (eV)
    J = np.array([-0.1, -0.05, 0, 0.05, 0.1, 0.15, 0.2])

    # Number of f-electrons (example data)
    NSCF = np.array([2.182, 2.345, 2.517, 2.697, 2.885, 3.08, 3.282])
    SCF  = np.array([2.448, 2.461, 2.520, 2.533, 2.548, 2.563, 2.575])

    # Fit linear response (n vs J)
    s_n, intercept_n = np.polyfit(J, NSCF, 1)
    s_s, intercept_s = np.polyfit(J, SCF, 1)

    U = 1.0/s_s - 1.0/s_n

    # Generate fits
    J_fit = np.linspace(J.min(), J.max(), 200)
    fit_NSCF = s_n * J_fit + intercept_n
    fit_SCF  = s_s * J_fit + intercept_s

    # Print results
    print(f"chi0 (NSCF slope) = {s_n:.4f}")
    print(f"chi  (SCF slope)  = {s_s:.4f}")
    print(f"U (eV)            = {U:.4f}")

    # Plot (like VASP wiki)
    plt.figure(figsize=(7,5))
    plt.scatter(J, NSCF, color='black', label='NSCF', marker='o', facecolors='none', s=70)
    plt.scatter(J, SCF,  color='red', label='SCF',  marker='s', s=60)
    plt.plot(J_fit, fit_NSCF, color='black', linestyle='-', label=f'NSCF fit (χ₀={s_n:.3f})')
    plt.plot(J_fit, fit_SCF,  color='red', linestyle='-', label=f'SCF fit (χ={s_s:.3f})')
    plt.xlabel("Applied potential J (eV)")
    plt.ylabel("Number of f-electrons")
    plt.title("Linear Response for Hubbard U Determination of UGe₂")
    plt.grid(True, linestyle=':')
    plt.legend()
    plt.tight_layout()
    plt.show()
    </pre>

            <p><b>Example output:</b></p>
            <pre>
    chi0 (NSCF slope) = 3.6700
    chi  (SCF slope)  = 0.4379
    U (eV)            = 2.0114
            </pre>

            <p>This method extracts the on-site Coulomb interaction <b>U</b> via linear response by comparing self-consistent and non-self-consistent changes in orbital occupations with applied potential perturbations.</p>
        </ol>
        <div class="section-divider"></div>
    </section>

    <section class="section" id="8">
        <h2>Work function</h2>
        <ol>
            Check back soon!
        </ol>
        <div class="section-divider"></div>
    </section>

    <section class="section" id="8">
        <h2>Phonons</h2>
        <ol>
            Check back soon!
        </ol>
        <div class="section-divider"></div>
    </section>

    <section class="section" id="8">
        <h2>Processor Considerations</h2>
        <div class="section-divider"></div>
        <ol>
            <li>More processors doesn’t necessarily mean faster computations!
            </li>
            <ul>
                <li>Increasing the number of processors may not significantly
                    accelerate the process due to several factors.</li>
                <li>Efficiency of parallelization parameters: It's important to
                    optimize parameters like NCORE. For instance, setting
                    NCORE=8 can enhance parallel performance when using 72
                    processors.</li>
                <li>Hardware limitations: The computer I utilized has 44
                    physical cores. Utilizing hyperthreading, the difference
                    between running 2 threads versus one core is only about a
                    15% improvement.</li>
                <li>Diminishing returns: In this scenario, utilizing more than
                    32 cores may not substantially expedite the computation.
                </li>
                <li>Despite these considerations, it's worthwhile to experiment
                    with different processor configurations to assess
                    performance.</li>
            </ul>
        </ol>
    </section>

    <section class="section" id="7">
        <h2>Troubleshooting errors</h2>
        <ol>
            <li>
                <code>ERROR FEXCP: supplied exchange-correlation table is too small, maximal index: 5536</code>
                <ul>
                    <li>Solved by adding the following to the INCAR:</li>
                    <ul>
                        <li>IBRION=1</li>
                        <li>ISIF=2</li>
                    </ul>
                </ul>
            </li>
            <li>
                <code>internal error in FOCK_FCC: number of k-points incorrect 5 18 2 2 2</code>
                <ul>
                    <li>Solved by ensuring KPOINTS are divisible by the grid reduction factors:</li>
                    <ul>
                        <li>NKREDX = 2</li>
                        <li>NKREDY = 2</li>
                        <li>NKREDZ = 2</li>
                    </ul>
                    <li>For example, a 5 x 5 x 5 mesh will not work. Use 4 x 4 x 4, etc.</li>
                    <li>Solution found <a href="https://www.vasp.at/forum/viewtopic.php?t=6556" target="_blank"
                            rel="noopener">here</a>.</li>
                </ul>
            </li>
        </ol>
        <h3>Further debugging resources</h3>
        <ul>
            <li><a href="https://dannyvanpoucke.be/vasp-errors-en/" target="_blank" rel="noopener">Common VASP errors
                    and solutions</a></li>
            <li><a href="https://groups.google.com/g/matproj-develop/c/fJhMXmfpuBU" target="_blank"
                    rel="noopener">Materials Project Google Group: VASP errors</a></li>
            <li><a href="https://www.vasp.at/forum/viewtopic.php?f=4&t=18042" target="_blank" rel="noopener">VASP Forum:
                    Error discussion 1</a></li>
            <li><a href="https://w.vasp.at/forum/viewtopic.php?p=25228" target="_blank" rel="noopener">VASP Forum: Error
                    discussion 2</a></li>
            <li><a href="https://ww.vasp.at/forum/viewtopic.php?t=18319" target="_blank" rel="noopener">VASP Forum:
                    Error discussion 3</a></li>
        </ul>
        <li>To calculate NBANDS:
            <ul>
                <li># of bands = (# of electrons/2) + (# of ions*2)</li>
                <ul>
                    <li>Running <code>grep NELECT OUTCAR</code> after an optimization
                        will give you the number of electrons, and grep
                        NIONS OUTCAR will give you the number of ions</li>
                    <li>Running <code>grep VRHFIN POTCAR</code> may also give you the
                        number of bands (not certain, have to double check)
                    </li>
                </ul>
            </ul>
        </li>
        </ol>
        <div class="section-divider"></div>
    </section>


    <footer>
        <a href="https://emiljaffal.github.io" class="button">Go to the home
            page</a>
    </footer>

</body>

</html>